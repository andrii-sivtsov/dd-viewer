var t=/*#__PURE__*/function(){function t(t,e){void 0===e&&(e={}),this.options=Object.assign({styles:!0,closeOnOverlay:!0,hooks:{open:null,close:null},watchAsyncContent:!1,thumbs:!0,mount:"auto",trigger:"card",template:null,selectors:{root:".ddlb-modal",img:".ddlb-modal-image"},logs:!1},e),this.ui={modalRoot:".ddlb-modal",modalWindow:".ddlb-modal-window",modalImage:".ddlb-modal-image",slidePrevBtn:".ddlb-prev",slideNextBtn:".ddlb-next",thumbsWrap:".ddlb-thumbs",thumbsViewport:".ddlb-thumbs-viewport",thumbsTrack:".ddlb-thumbs-track",thumbsPrevBtn:".ddlb-thumbs-prev",thumbsNextBtn:".ddlb-thumbs-next",thumbButton:".ddlb-thumb"},this.cardSelector=t,this.cards=[],this.activeIndex=-1,this._mountModal(),this._collectCards(),this._bindCards(),this.options.watchAsyncContent&&this._watchAsyncCards(),this._log("init",{selector:t,cards:this.cards.length})}var e=t.prototype;return e._log=function(t,e){void 0===e&&(e={}),this.options.logs&&console.log("[DDViewer LOG] "+t,Object.keys(e).length?e:"")},e._ensureMounted=function(){this.modalRoot&&this.modalImageEl||this._mountModal()},e._qs=function(t,e){return void 0===e&&(e=document),e.querySelector(t)},e._qsa=function(t,e){return void 0===e&&(e=document),Array.from(e.querySelectorAll(t))},e._collectCards=function(){this.cards=this._qsa(this.cardSelector).filter(function(t){return 1===(null==t?void 0:t.nodeType)}),this.cards.length||console.warn("[DDViewer] no cards by selector:",this.cardSelector)},e._bindCards=function(){var t=this;"card"===this.options.trigger&&this.cards.forEach(function(e,s){e.addEventListener("click",function(e){e.preventDefault(),t._ensureMounted(),t.modalRoot&&t.modalImageEl?t.openByIndex(s):setTimeout(function(){return t.openByIndex(s)},0)})})},e._watchAsyncCards=function(){var t=this;if("auto"!==this.options.watchAsyncContent){if("object"==typeof this.options.watchAsyncContent&&this.options.watchAsyncContent.button){var e=this.options.watchAsyncContent.button;document.addEventListener("click",function(s){s.target.closest(e)&&setTimeout(function(){t._collectCards(),t._bindCards(),t._log("cards rebound",{total:t.cards.length})},50)})}}else new MutationObserver(function(){t._collectCards(),t._bindCards()}).observe(document.body,{childList:!0,subtree:!0})},e._mountModal=function(){var t=null;if("object"!=typeof this.options.mount||!this.options.mount.ui||(t=this._qs(this.options.mount.ui))){if("manual"===this.options.mount||t){var e=t||document;return this.modalRoot=this._qs(this.options.selectors.root||this.ui.modalRoot,e),this.modalImageEl=this._qs(this.options.selectors.img||this.ui.modalImage,e),this.modalRoot&&this.modalImageEl||console.warn("[DDViewer] manual/adopt: selectors not found"),void this._bindGlobalEvents()}var s=this._qs(this.ui.modalRoot);if(s)return this.modalRoot=s,this.modalImageEl=this._qs(this.ui.modalImage,s),void this._bindGlobalEvents();var i=null;if("function"==typeof this.options.template){var o=this.options.template(this.ui);if("string"==typeof o){var n=document.createElement("div");n.innerHTML=o.trim(),i=n.firstElementChild}else o&&1===o.nodeType&&(i=o)}i||(i=this._createDefaultModal()),document.body.appendChild(i),this.modalRoot=i,this.modalImageEl=this._qs(this.ui.modalImage,this.modalRoot),this._bindGlobalEvents()}else console.warn("[DDViewer] mount.ui not found:",this.options.mount.ui)},e._createDefaultModal=function(){var t=function(t,e,s){void 0===s&&(s={});var i=document.createElement(t);for(var o in e&&(i.className=e.replace(/^\./,"")),s)i.setAttribute(o,s[o]);return i},e=t("div",this.ui.modalRoot,{"aria-hidden":"true"}),s=t("div",this.ui.modalWindow),i=t("img",this.ui.modalImage,{alt:""}),o=t("button",this.ui.slidePrevBtn);o.type="button",o.textContent="‹";var n=t("button",this.ui.slideNextBtn);n.type="button",n.textContent="›";var a=null,r=null,l=null,d=null,h=null;if(this.options.thumbs&&(a=t("div",this.ui.thumbsWrap),(d=t("button",this.ui.thumbsPrevBtn)).type="button",d.textContent="‹",r=t("div",this.ui.thumbsViewport),l=t("div",this.ui.thumbsTrack),(h=t("button",this.ui.thumbsNextBtn)).type="button",h.textContent="›",r.appendChild(l),a.append(d,r,h)),this.options.styles&&(e.style.cssText="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.75);z-index:9999;pointer-events:none;opacity:0;transition:opacity .25s ease",s.style.cssText="position:relative;width:min(92vw,1200px);max-height:90vh;overflow:hidden;display:flex;align-items:center;justify-content:center;gap:12px",i.style.cssText="max-width:100%;max-height:80vh;display:block;object-fit:contain",o.style.cssText=n.style.cssText="position:absolute;top:50%;transform:translateY(-50%);width:44px;height:44px;border-radius:999px;border:0;background:rgba(0,0,0,.45);color:#fff;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;user-select:none",o.style.left="12px",n.style.right="12px",a)){a.style.cssText="position:absolute;left:24px;right:24px;bottom:20px;display:flex;justify-content:center;align-items:center;gap:12px;pointer-events:auto";var u="width:36px;height:36px;border-radius:999px;border:0;background:rgba(0,0,0,.45);color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex:0 0 auto;user-select:none";d.style.cssText=u,h.style.cssText=u,r.style.cssText="overflow-x:auto;max-width:100%;scrollbar-width:none;-ms-overflow-style:none",r.addEventListener("wheel",function(t){Math.abs(t.deltaX)<Math.abs(t.deltaY)||(t.preventDefault(),r.scrollLeft+=t.deltaY)},{passive:!1}),r.style.scrollbarWidth="none",l.style.cssText="display:flex;gap:12px"}return s.append(o,i,n),e.appendChild(s),a&&e.appendChild(a),e},e._bindGlobalEvents=function(){var t=this;if(this.modalRoot){this.options.closeOnOverlay&&this.modalRoot.addEventListener("click",function(e){var s=e.target.closest(t.ui.modalImage),i=e.target.closest(t.ui.slidePrevBtn),o=e.target.closest(t.ui.slideNextBtn),n=e.target.closest(t.ui.thumbsWrap);s||i||o||n||t.close()}),document.addEventListener("keydown",function(e){t.modalRoot&&"true"!==t.modalRoot.getAttribute("aria-hidden")&&("Escape"===e.key&&t.close(),"ArrowRight"===e.key&&t.next(),"ArrowLeft"===e.key&&t.prev())});var e=this._qs(this.ui.slidePrevBtn,this.modalRoot),s=this._qs(this.ui.slideNextBtn,this.modalRoot);e&&e.addEventListener("click",function(){return t.prev()}),s&&s.addEventListener("click",function(){return t.next()});var i=this._qs(this.ui.thumbsViewport,this.modalRoot),o=this._qs(this.ui.thumbsTrack,this.modalRoot),n=this._qs(this.ui.thumbsPrevBtn,this.modalRoot),a=this._qs(this.ui.thumbsNextBtn,this.modalRoot);if(this.options.thumbs){if(i&&n&&a){var r,l=function(){return Math.floor(.9*i.clientWidth)},d=function(e){var s=Math.max(0,i.scrollWidth-i.clientWidth),o=Math.max(0,Math.min(s,Math.round(i.scrollLeft+e)));i.scrollTo({left:o,behavior:"smooth"}),t._updateThumbsArrows()};n.addEventListener("click",function(){return d(-l())}),a.addEventListener("click",function(){return d(l())}),i.addEventListener("scroll",function(){return t._updateThumbsArrows()},{passive:!0}),this._updateThumbsArrows(),null==(r=this._thumbsRO)||null==r.disconnect||r.disconnect(),this._thumbsRO=new ResizeObserver(function(){return t._updateThumbsArrows()}),this._thumbsRO.observe(i),o&&this._thumbsRO.observe(o),this._updateThumbsArrowsBound||(this._updateThumbsArrowsBound=function(){return t._updateThumbsArrows()}),window.addEventListener("orientationchange",this._updateThumbsArrowsBound),window.addEventListener("resize",this._updateThumbsArrowsBound)}}else n&&(n.style.display="none"),a&&(a.style.display="none")}},e._updateThumbsArrows=function(){if(this.options.thumbs){var t=this._qs(this.ui.thumbsViewport,this.modalRoot),e=this._qs(this.ui.thumbsPrevBtn,this.modalRoot),s=this._qs(this.ui.thumbsNextBtn,this.modalRoot);if(t&&e&&s){var i=Math.max(0,t.scrollWidth-t.clientWidth),o=i>1;if(e.style.display=o?"":"none",s.style.display=o?"":"none",o){var n=t.scrollLeft<=1,a=t.scrollLeft>=i-1;e.disabled=n,s.disabled=a,e.setAttribute("aria-disabled",n?"true":"false"),s.setAttribute("aria-disabled",a?"true":"false")}}}},e._buildThumbsIfNeeded=function(){var t=this;if(this.options.thumbs){var e=this._qs(this.ui.thumbsTrack,this.modalRoot),s=this._qs(this.ui.thumbsViewport,this.modalRoot);e&&s&&(e.dataset.built||(e.innerHTML="",this.cards.forEach(function(s,i){var o,n=s.getAttribute("data-dd-src")||(null==(o=s.querySelector("img"))?void 0:o.getAttribute("src")),a=document.createElement("button");a.type="button",a.className=t.ui.thumbButton.replace(/^\./,""),a.dataset.index=i;var r=document.createElement("img");r.alt="",r.decoding="async",r.loading="lazy",r.src=n||"",t.options.styles&&(a.style.cssText="flex:0 0 auto; border:2px solid transparent; padding:0; background:transparent",r.style.cssText="width:64px;height:64px;object-fit:cover;display:block;border-radius:4px"),a.appendChild(r),a.addEventListener("click",function(){return t.openByIndex(i)}),e.appendChild(a)}),e.dataset.built="1",this._updateThumbsArrows()))}},e._markActiveThumb=function(t){var e=this;if(this.options.thumbs){var s=this._qs(this.ui.thumbsTrack,this.modalRoot);if(s){this._qsa(this.ui.thumbButton+".is-active",s).forEach(function(t){return t.classList.remove("is-active")});var i=this._qs(this.ui.thumbButton+'[data-index="'+t+'"]',s);i&&(i.classList.add("is-active"),this.options.styles&&(i.style.borderColor="#fff"),this._qsa(this.ui.thumbButton,s).forEach(function(t){t!==i&&e.options.styles&&(t.style.borderColor="transparent")}),this._centerActiveThumb(i))}}},e._centerActiveThumb=function(t){var e=this._qs(this.ui.thumbsViewport,this.modalRoot);if(e&&t){var s=e.getBoundingClientRect(),i=t.getBoundingClientRect();e.scrollTo({left:Math.max(0,e.scrollLeft+((i.left+i.right)/2-(s.left+s.right)/2)),behavior:"smooth"})}},e.openByIndex=function(t){var e;if(this.cards.length){var s=this.cards.length-1;t<0&&(t=0),t>s&&(t=s);var i=this.cards[t],o=i.getAttribute("data-dd-src")||(null==(e=i.querySelector("img"))?void 0:e.getAttribute("src"));o&&(this.activeIndex=t,this._buildThumbsIfNeeded(),this._updateThumbsArrows(),this._markActiveThumb(t),this.open(o))}},e.next=function(){this.activeIndex<0||this.openByIndex((this.activeIndex+1)%this.cards.length)},e.prev=function(){this.activeIndex<0||this.openByIndex((this.activeIndex-1+this.cards.length)%this.cards.length)},e.open=function(t){var e;t&&this.modalImageEl&&(this._log("modal open",{src:t}),this.modalImageEl.src=t,this.modalRoot.setAttribute("aria-hidden","false"),null!=(e=this.options.hooks)&&e.open?this.options.hooks.open({root:this.modalRoot,img:this.modalImageEl,src:t}):(this.modalRoot.style.pointerEvents="auto",this.options.styles&&(this.modalRoot.style.opacity="1")))},e.close=function(){var t,e;this.modalRoot&&(this._log("modal close"),null!=(t=this.options.hooks)&&t.close?this.options.hooks.close({root:this.modalRoot,img:this.modalImageEl}):(this.options.styles&&(this.modalRoot.style.opacity="0"),this.modalRoot.setAttribute("aria-hidden","true"),this.modalRoot.style.pointerEvents="none",null==(e=this._thumbsRO)||null==e.disconnect||e.disconnect(),this._thumbsRO=null,this._updateThumbsArrowsBound&&(window.removeEventListener("orientationchange",this._updateThumbsArrowsBound),window.removeEventListener("resize",this._updateThumbsArrowsBound))))},t}();"undefined"!=typeof window&&(window.DDViewer=t),module.exports=t;
